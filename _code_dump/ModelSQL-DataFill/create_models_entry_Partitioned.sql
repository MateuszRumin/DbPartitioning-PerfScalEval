DROP DATABASE IF EXISTS stackexchenege;
CREATE DATABASE stackexchenege;
USE stackexchenege;

-- Drop tables with correct names (fixing typos from original)
DROP TABLE IF EXISTS badges;
DROP TABLE IF EXISTS comments;
DROP TABLE IF EXISTS post_history;
DROP TABLE IF EXISTS post_links;
DROP TABLE IF EXISTS posts;
DROP TABLE IF EXISTS tags;
DROP TABLE IF EXISTS users;  -- Original had typo 'user' in DROP
DROP TABLE IF EXISTS votes;

-- 1. Badges (partitioned by badge_date)
CREATE TABLE badges (
  id INT,
  user_id INT,
  badge_name VARCHAR(500),
  badge_date DATETIME NOT NULL,  -- Made NOT NULL for partitioning
  class INT,
  tag_based VARCHAR(10),
  PRIMARY KEY (id, badge_date)  -- Composite PK for partitioning
)
PARTITION BY RANGE COLUMNS(badge_date) (
    PARTITION p0 VALUES LESS THAN ('2009-01-01'),
    PARTITION p1 VALUES LESS THAN ('2010-01-01'),
    PARTITION p2 VALUES LESS THAN ('2011-01-01'),
    PARTITION p3 VALUES LESS THAN ('2012-01-01'),
    PARTITION p4 VALUES LESS THAN ('2013-01-01'),
    PARTITION p5 VALUES LESS THAN ('2014-01-01'),
    PARTITION p6 VALUES LESS THAN ('2015-01-01'),
    PARTITION p7 VALUES LESS THAN ('2016-01-01'),
    PARTITION p8 VALUES LESS THAN ('2017-01-01'),
    PARTITION p9 VALUES LESS THAN ('2018-01-01'),
    PARTITION p10 VALUES LESS THAN ('2019-01-01'),
    PARTITION p11 VALUES LESS THAN ('2020-01-01'),
    PARTITION p12 VALUES LESS THAN ('2021-01-01'),
    PARTITION p13 VALUES LESS THAN ('2022-01-01'),
    PARTITION p14 VALUES LESS THAN ('2023-01-01'),
    PARTITION p15 VALUES LESS THAN ('2024-01-01'),
    PARTITION p16 VALUES LESS THAN ('2025-01-01'),
    PARTITION p17 VALUES LESS THAN (MAXVALUE)
);

-- 2. Comments (partitioned by creation_date)
CREATE TABLE comments (
    id INT,
    post_id INT,
    score INT,
    comment_text VARCHAR(4000),
    creation_date DATETIME NOT NULL,
    user_id INT,
    content_license VARCHAR(100),
    PRIMARY KEY (id, creation_date)
)
PARTITION BY RANGE COLUMNS(creation_date) (
    PARTITION p0 VALUES LESS THAN ('2009-01-01'),
    PARTITION p1 VALUES LESS THAN ('2010-01-01'),
    PARTITION p2 VALUES LESS THAN ('2011-01-01'),
    PARTITION p3 VALUES LESS THAN ('2012-01-01'),
    PARTITION p4 VALUES LESS THAN ('2013-01-01'),
    PARTITION p5 VALUES LESS THAN ('2014-01-01'),
    PARTITION p6 VALUES LESS THAN ('2015-01-01'),
    PARTITION p7 VALUES LESS THAN ('2016-01-01'),
    PARTITION p8 VALUES LESS THAN ('2017-01-01'),
    PARTITION p9 VALUES LESS THAN ('2018-01-01'),
    PARTITION p10 VALUES LESS THAN ('2019-01-01'),
    PARTITION p11 VALUES LESS THAN ('2020-01-01'),
    PARTITION p12 VALUES LESS THAN ('2021-01-01'),
    PARTITION p13 VALUES LESS THAN ('2022-01-01'),
    PARTITION p14 VALUES LESS THAN ('2023-01-01'),
    PARTITION p15 VALUES LESS THAN ('2024-01-01'),
    PARTITION p16 VALUES LESS THAN ('2025-01-01'),
    PARTITION p17 VALUES LESS THAN (MAXVALUE)
);

-- 3. Post History (partitioned by creation_date)
CREATE TABLE post_history (
  id INT,
  post_history_type_id INT,
  post_id INT,
  revision_guid VARCHAR(100),
  creation_date DATETIME NOT NULL,
  user_id INT,
  post_text VARCHAR(10000),
  content_license VARCHAR(100),
  PRIMARY KEY (id, creation_date)
)
PARTITION BY RANGE COLUMNS(creation_date) (
    PARTITION p0 VALUES LESS THAN ('2009-01-01'),
    PARTITION p1 VALUES LESS THAN ('2010-01-01'),
    PARTITION p2 VALUES LESS THAN ('2011-01-01'),
    PARTITION p3 VALUES LESS THAN ('2012-01-01'),
    PARTITION p4 VALUES LESS THAN ('2013-01-01'),
    PARTITION p5 VALUES LESS THAN ('2014-01-01'),
    PARTITION p6 VALUES LESS THAN ('2015-01-01'),
    PARTITION p7 VALUES LESS THAN ('2016-01-01'),
    PARTITION p8 VALUES LESS THAN ('2017-01-01'),
    PARTITION p9 VALUES LESS THAN ('2018-01-01'),
    PARTITION p10 VALUES LESS THAN ('2019-01-01'),
    PARTITION p11 VALUES LESS THAN ('2020-01-01'),
    PARTITION p12 VALUES LESS THAN ('2021-01-01'),
    PARTITION p13 VALUES LESS THAN ('2022-01-01'),
    PARTITION p14 VALUES LESS THAN ('2023-01-01'),
    PARTITION p15 VALUES LESS THAN ('2024-01-01'),
    PARTITION p16 VALUES LESS THAN ('2025-01-01'),
    PARTITION p17 VALUES LESS THAN (MAXVALUE)
);

-- 4. Post Links (partitioned by creation_date)
CREATE TABLE post_links (
    id INT,
    creation_date DATETIME NOT NULL,
    post_id INT,
    related_post_id INT,
    link_type_id INT,
    PRIMARY KEY (id, creation_date)
)
PARTITION BY RANGE COLUMNS(creation_date) (
    PARTITION p0 VALUES LESS THAN ('2009-01-01'),
    PARTITION p1 VALUES LESS THAN ('2010-01-01'),
    PARTITION p2 VALUES LESS THAN ('2011-01-01'),
    PARTITION p3 VALUES LESS THAN ('2012-01-01'),
    PARTITION p4 VALUES LESS THAN ('2013-01-01'),
    PARTITION p5 VALUES LESS THAN ('2014-01-01'),
    PARTITION p6 VALUES LESS THAN ('2015-01-01'),
    PARTITION p7 VALUES LESS THAN ('2016-01-01'),
    PARTITION p8 VALUES LESS THAN ('2017-01-01'),
    PARTITION p9 VALUES LESS THAN ('2018-01-01'),
    PARTITION p10 VALUES LESS THAN ('2019-01-01'),
    PARTITION p11 VALUES LESS THAN ('2020-01-01'),
    PARTITION p12 VALUES LESS THAN ('2021-01-01'),
    PARTITION p13 VALUES LESS THAN ('2022-01-01'),
    PARTITION p14 VALUES LESS THAN ('2023-01-01'),
    PARTITION p15 VALUES LESS THAN ('2024-01-01'),
    PARTITION p16 VALUES LESS THAN ('2025-01-01'),
    PARTITION p17 VALUES LESS THAN (MAXVALUE)
);

-- 5. Posts (main partitioned table)
CREATE TABLE posts (
    id INT,
    post_type_id INT,
    accepted_answer_id INT,
    parent_id INT,
    creation_date DATETIME NOT NULL,  -- Made NOT NULL
    score INT,
    view_count INT,
    post_body VARCHAR(10000),
    owner_user_id INT,
    last_editor_user_id INT,
    last_edit_date DATETIME,
    last_activity_date DATETIME,
    post_title VARCHAR(500),
    tags VARCHAR(500),
    answer_count INT,
    comment_count INT,
    content_license VARCHAR(100),
    PRIMARY KEY (id, creation_date)  -- Composite PK
)
PARTITION BY RANGE COLUMNS(creation_date) (
    PARTITION p0 VALUES LESS THAN ('2009-01-01'),
    PARTITION p1 VALUES LESS THAN ('2010-01-01'),
    PARTITION p2 VALUES LESS THAN ('2011-01-01'),
    PARTITION p3 VALUES LESS THAN ('2012-01-01'),
    PARTITION p4 VALUES LESS THAN ('2013-01-01'),
    PARTITION p5 VALUES LESS THAN ('2014-01-01'),
    PARTITION p6 VALUES LESS THAN ('2015-01-01'),
    PARTITION p7 VALUES LESS THAN ('2016-01-01'),
    PARTITION p8 VALUES LESS THAN ('2017-01-01'),
    PARTITION p9 VALUES LESS THAN ('2018-01-01'),
    PARTITION p10 VALUES LESS THAN ('2019-01-01'),
    PARTITION p11 VALUES LESS THAN ('2020-01-01'),
    PARTITION p12 VALUES LESS THAN ('2021-01-01'),
    PARTITION p13 VALUES LESS THAN ('2022-01-01'),
    PARTITION p14 VALUES LESS THAN ('2023-01-01'),
    PARTITION p15 VALUES LESS THAN ('2024-01-01'),
    PARTITION p16 VALUES LESS THAN ('2025-01-01'),
    PARTITION p17 VALUES LESS THAN (MAXVALUE)
);

-- 6. Tags (not partitioned)
CREATE TABLE tags (
    id INT PRIMARY KEY,
    tag_name VARCHAR(100),
    tag_count INT,
    except_post_id INT,
    wiki_post_id INT
);

-- 7. Users (not partitioned)
CREATE TABLE users (
    id INT PRIMARY KEY,
    reputation INT,
    creation_date DATETIME,
    display_name VARCHAR(200),
    last_access_date DATETIME,
    website_url VARCHAR(1000),
    location VARCHAR(200),
    about_me VARCHAR(10000),
    views INT,
    upvotes INT,
    downvotes INT,
    account_id INT
);

-- 8. Votes (partitioned by creation_date)
CREATE TABLE votes (
    id INT,
    post_id INT,
    vote_type_id INT,
    creation_date DATETIME NOT NULL,
    PRIMARY KEY (id, creation_date)
)
PARTITION BY RANGE COLUMNS(creation_date) (
    PARTITION p0 VALUES LESS THAN ('2009-01-01'),
    PARTITION p1 VALUES LESS THAN ('2010-01-01'),
    PARTITION p2 VALUES LESS THAN ('2011-01-01'),
    PARTITION p3 VALUES LESS THAN ('2012-01-01'),
    PARTITION p4 VALUES LESS THAN ('2013-01-01'),
    PARTITION p5 VALUES LESS THAN ('2014-01-01'),
    PARTITION p6 VALUES LESS THAN ('2015-01-01'),
    PARTITION p7 VALUES LESS THAN ('2016-01-01'),
    PARTITION p8 VALUES LESS THAN ('2017-01-01'),
    PARTITION p9 VALUES LESS THAN ('2018-01-01'),
    PARTITION p10 VALUES LESS THAN ('2019-01-01'),
    PARTITION p11 VALUES LESS THAN ('2020-01-01'),
    PARTITION p12 VALUES LESS THAN ('2021-01-01'),
    PARTITION p13 VALUES LESS THAN ('2022-01-01'),
    PARTITION p14 VALUES LESS THAN ('2023-01-01'),
    PARTITION p15 VALUES LESS THAN ('2024-01-01'),
    PARTITION p16 VALUES LESS THAN ('2025-01-01'),
    PARTITION p17 VALUES LESS THAN (MAXVALUE)
);